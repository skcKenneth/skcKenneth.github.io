{% include base_path %}

<!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="{{ base_path }}/images/apple-touch-icon-57x57.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="60x60" href="{{ base_path }}/images/apple-touch-icon-60x60.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="72x72" href="{{ base_path }}/images/apple-touch-icon-72x72.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="76x76" href="{{ base_path }}/images/apple-touch-icon-76x76.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="114x114" href="{{ base_path }}/images/apple-touch-icon-114x114.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="120x120" href="{{ base_path }}/images/apple-touch-icon-120x120.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="144x144" href="{{ base_path }}/images/apple-touch-icon-144x144.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="152x152" href="{{ base_path }}/images/apple-touch-icon-152x152.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="180x180" href="{{ base_path }}/images/apple-touch-icon-180x180.png?v=M44lzPylqQ">
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32">
<link rel="icon" type="image/png" href="{{ base_path }}/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192">
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96">
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16">
<link rel="manifest" href="{{ base_path }}/images/manifest.json?v=M44lzPylqQ">
<link rel="mask-icon" href="{{ base_path }}/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000">
<link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ">
<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="{{ base_path }}/images/mstile-144x144.png?v=M44lzPylqQ">
<meta name="msapplication-config" content="{{ base_path }}/images/browserconfig.xml?v=M44lzPylqQ">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="{{ base_path }}/assets/css/academicons.css"/>


<!-- Support for MathJax 3.0 -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      macros: {
        degree: '^{\\circ}'
      }
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    startup: {
      ready: function() {
        var MathJax = window.MathJax;
        var startup = MathJax.startup;
        var document = startup.document;
        
        // Fix double backslashes BEFORE MathJax processes
        function fixDoubleBackslashes() {
          if (!document.body) return;
          
          var html = document.body.innerHTML;
          var original = html;
          
          // Fix double backslashes in math: \\theta -> \theta (but preserve \\\\ for line breaks)
          html = html.replace(/\$\s*([^$\n]+?)\s*\$/g, function(match, math) {
            // Replace \\command with \command
            math = math.replace(/\\\\([a-zA-Z@{}[\]]+|\\[a-zA-Z]+)/g, function(m) {
              // Don't replace \\\\ (line breaks)
              if (m.length > 2 && m[2] === '\\') return m;
              return m.replace(/^\\\\/, '\\');
            });
            return '$' + math.trim() + '$';
          });
          
          html = html.replace(/\$\$\s*([^$]+?)\s*\$\$/g, function(match, math) {
            math = math.replace(/\\\\([a-zA-Z@{}[\]]+|\\[a-zA-Z]+)/g, function(m) {
              if (m.length > 2 && m[2] === '\\') return m;
              return m.replace(/^\\\\/, '\\');
            });
            return '$$' + math.trim() + '$$';
          });
          
          if (html !== original) {
            document.body.innerHTML = html;
          }
        }
        
        // Run fix BEFORE MathJax processes
        fixDoubleBackslashes();
        
        // Call default ready to process math
        return startup.defaultReady();
      }
    }
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  // Find and fix unprocessed math expressions
  (function() {
    function findAndFixUnprocessed() {
      if (!document.body || !window.MathJax) return;
      
      // Find text nodes that still contain $...$ (unprocessed math)
      var walker = document.createTreeWalker(
        document.body,
        NodeFilter.SHOW_TEXT,
        null,
        false
      );
      
      var unprocessed = [];
      var node;
      while (node = walker.nextNode()) {
        var text = node.textContent;
        // Look for $...$ that's not inside MathJax elements
        if (text.includes('$') && !/\$[^$]*\$/.test(text)) {
          // Check if parent is already a MathJax element
          var parent = node.parentElement;
          var isInMathJax = false;
          while (parent) {
            if (parent.classList && (parent.classList.contains('MathJax') || parent.id && parent.id.startsWith('MathJax'))) {
              isInMathJax = true;
              break;
            }
            parent = parent.parentElement;
          }
          
          if (!isInMathJax && /\$[^$\n]+\$/.test(text)) {
            unprocessed.push({node: node, text: text});
          }
        }
      }
      
      if (unprocessed.length > 0) {
        console.log('Found', unprocessed.length, 'unprocessed math expressions');
        
        // Fix double backslashes and reprocess
        var html = document.body.innerHTML;
        html = html.replace(/\$\s*([^$\n]+?)\s*\$/g, function(match, math) {
          math = math.replace(/\\\\([a-zA-Z@{}[\]]+|\\[a-zA-Z]+)/g, function(m) {
            if (m.length > 2 && m[2] === '\\') return m;
            return m.replace(/^\\\\/, '\\');
          });
          return '$' + math.trim() + '$';
        });
        
        document.body.innerHTML = html;
        
        // Reprocess with MathJax
        if (window.MathJax.typesetPromise) {
          window.MathJax.typesetPromise().then(function() {
            console.log('Reprocessed', unprocessed.length, 'expressions');
          });
        }
      }
    }
    
    // Wait for MathJax and run after it processes
    function waitForMathJax() {
      if (window.MathJax && window.MathJax.startup) {
        window.MathJax.startup.promise.then(function() {
          // Wait a bit for initial processing, then check for unprocessed
          setTimeout(findAndFixUnprocessed, 500);
        });
      } else {
        setTimeout(waitForMathJax, 100);
      }
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', waitForMathJax);
    } else {
      waitForMathJax();
    }
  })();
</script>
<!-- end custom head snippets -->
