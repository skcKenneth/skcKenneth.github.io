{% include base_path %}

<!-- start custom head snippets -->

<!-- Support for Academicons -->
<link rel="stylesheet" href="{{ base_path }}/assets/css/academicons.css"/>

<!-- favicon from https://commons.wikimedia.org/wiki/File:OOjs_UI_icon_academic-progressive.svg -->
<link rel="apple-touch-icon" sizes="180x180" href="{{ base_path }}/images/apple-touch-icon-180x180.png"/>
<link rel="icon" type="image/svg+xml" href="{{ base_path }}/images/favicon.svg"/>
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-32x32.png" sizes="32x32"/>
<link rel="icon" type="image/png" href="{{ base_path }}/images/favicon-192x192.png" sizes="192x192"/>
<link rel="manifest" href="{{ base_path }}/images/manifest.json"/>
<link rel="icon" href="/images/favicon.ico"/>
<meta name="theme-color" content="#ffffff"/>


<!-- Support for MathJax 3.0 -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  };
</script>
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
  // Fix double-escaped backslashes from Kramdown
  // This runs after DOM is ready but before MathJax processes
  (function() {
    function fixEscapedBackslashes() {
      // Get all text nodes in the document
      const walker = document.createTreeWalker(
        document.body,
        NodeFilter.SHOW_TEXT,
        null,
        false
      );
      
      const replacements = [];
      let node;
      while (node = walker.nextNode()) {
        const originalText = node.textContent;
        // Fix double backslashes in LaTeX commands (but preserve \\ for line breaks)
        let fixedText = originalText.replace(/\$\$([^$]*?)\$\$/g, function(match, math) {
          return '$$' + math.replace(/\\\\([a-zA-Z{])/g, '\\$1').replace(/\\\\\s*\\\\/g, '\\\\\\\\') + '$$';
        });
        fixedText = fixedText.replace(/\$([^$\n]*?)\$/g, function(match, math) {
          return '$' + math.replace(/\\\\([a-zA-Z{])/g, '\\$1') + '$';
        });
        fixedText = fixedText.replace(/\\\[([^\]]*?)\\\]/g, function(match, math) {
          return '\\[' + math.replace(/\\\\([a-zA-Z{])/g, '\\$1').replace(/\\\\\s*\\\\/g, '\\\\\\\\') + '\\]';
        });
        fixedText = fixedText.replace(/\\\(([^)]*?)\\\)/g, function(match, math) {
          return '\\(' + math.replace(/\\\\([a-zA-Z{])/g, '\\$1') + '\\)';
        });
        
        if (fixedText !== originalText) {
          replacements.push({node: node, text: fixedText});
        }
      }
      
      // Apply replacements
      replacements.forEach(function(item) {
        item.node.textContent = item.text;
      });
    }
    
    // Run immediately if DOM is ready, otherwise wait
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', fixEscapedBackslashes);
    } else {
      fixEscapedBackslashes();
    }
    
    // Also run after a short delay to catch any dynamically loaded content
    setTimeout(fixEscapedBackslashes, 100);
  })();
</script>
<!-- end custom head snippets -->
